<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <title>Google Form 업로드 페이지 생성기</title>

    <style>
        body {
            font-family: Arial;
            padding: 40px;
        }

        table {
            border-collapse: collapse;
            margin-top: 20px;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 6px;
            text-align: center;
        }

        input,
        select {
            padding: 4px;
        }

        button {
            padding: 6px 12px;
            cursor: pointer;
        }

        .danger {
            background: #ff6b6b;
            color: white;
        }

        .primary {
            background: #4cafef;
            color: white;
        }
    </style>
</head>

<body>

    <h1>Google Form 업로드 페이지 생성기</h1>

    <h3>Form ID</h3>
    <input id="formId" style="width:400px" placeholder="form ID를 입력" />

    <h3>컬럼 설정</h3>

    <button onclick="addColumn()">컬럼 추가</button>

    <table id="configTable">
        <thead>
            <tr>
                <th>label</th>
                <th>entry</th>
                <th>type</th>
                <th>-</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <br>

    <button class="primary" onclick="generate()">HTML 다운로드</button>


    <script>
        const tbody = document.querySelector("#configTable tbody");

        // 기본 컬럼
        const defaultCols = [
            { label: "#", key: "", type: "index"},
            { label: "이름", key: "", type: "text"},
            { label: "현금", key: "", type: "text"},
            { label: "카드", key: "", type: "text"}
        ];

        defaultCols.forEach(c => addColumn(c));

        function addColumn(data = { label: "", key: "", type: "text"}) {
            const tr = document.createElement("tr");

            tr.innerHTML = `
            <td><input value="${data.label}" placeholder="라벨명을 입력"></td>
            <td><input value="${data.key}" placeholder="entry 숫자를 입력"></td>
            <td>
                <select>
                    <option>index</option>
                    <option>text</option>
                    <option>checkbox</option>
                </select>
            </td>
            <td><button class="danger">삭제</button></td>
        `;
            tr.querySelector("select").value = data.type;
            tr.querySelector(".danger").onclick = () => tr.remove();
            tbody.appendChild(tr);
        }

        function getColumns() {
            const rows = [...tbody.querySelectorAll("tr")];

            return rows.map(r => ({
                label: r.cells[0].querySelector("input").value,
                key: r.cells[1].querySelector("input").value,
                type: r.cells[2].querySelector("select").value
            }));
        }

        function generate() {

            const FORMID = document.getElementById("formId").value.trim();
            const cols = getColumns();

            const entryObj = {};
            cols.forEach(c => {
                if (c.key)
                    entryObj[c.key] = "entry.XXXXX";
            });

            const html = `
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<title>업로드 폼</title>
<style>
        body {
            font-family: Arial, sans-serif;
            padding: 30px;
        }

        h2 {
            margin-left: 10%;
        }

        table {
            margin-left: 10%;
            table-layout: auto;
            border-collapse: collapse;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
            white-space: nowrap;
        }

        input,
        select {
            width: 95%;
            padding: 4px;
        }

        input[type="checkbox"] {
            width: auto;
            transform: scale(1.2);
        }

        button {
            padding: 8px 14px;
            font-size: 14px;
            cursor: pointer;
            width: 100px;
        }

        .floating-buttons {
            position: fixed;
            left: 50px;
            top: 70%;
            transform: translateY(-50%);

            display: flex;
            flex-direction: column;
            gap: 10px;

            background: white;
            z-index: 999;
        }
</style>
</head>
<body>

<table id="form_table"></table>

<div class="floating-buttons">
<h2 id="title">작성 폼</h2>
<button onclick="addRow()">행 추가</button>
<button onclick="submitAll()">전체 제출</button>
</div>

<script>

const FORMID="${FORMID}";
const FORM_URL="https://docs.google.com/forms/d/e/"+FORMID+"/formResponse";

const COLUMNS=${JSON.stringify(cols, null, 4)};

const ENTRY=${JSON.stringify(entryObj, null, 4)};

const table=document.getElementById("form_table");

function build(){
    const thead=table.createTHead();
    const tr=thead.insertRow();

    COLUMNS.forEach(c=>{
        const th=document.createElement("th");
        th.innerText=c.label;
        tr.appendChild(th);
    });
    const sum_th = document.createElement("th");
    sum_th.innerText = "합계";
    tr.appendChild(sum_th);

    table.appendChild(document.createElement("tbody"));

    const tfoot=document.createElement("tfoot");
    const tr_cols=document.createElement("tr");
    const td_=document.createElement("td");
    td_.innerText="합계";
    tr_cols.appendChild(td_);
    COLUMNS.forEach(c=>{
        const td=document.createElement("td");
        td.setAttribute("class", "sum_cols")
        tr_cols.appendChild(td);
    });
    tfoot.appendChild(tr_cols);
    table.appendChild(tfoot);

    for(let i=0;i<40;i++) addRow();
    
    table.addEventListener("input", function (e) {
    if (e.target.tagName === "INPUT") {
        updateSums();
    }});
}

function createRow(idx){
    const tr=document.createElement("tr");

    COLUMNS.forEach(c=>{
        const td=document.createElement("td");

        if(c.type==="index") td.innerText=idx;
        else{
            const input=document.createElement("input");
            input.type=(c.type==="checkbox")?"checkbox":c.type;
            td.appendChild(input);
        }

        tr.appendChild(td);
    });

    const td=document.createElement("td");
    td.setAttribute("class", "sum_row");
    tr.appendChild(td);

    return tr;
}

function addRow(){
    const tbody=table.querySelector("tbody");
    tbody.appendChild(createRow(tbody.rows.length+1));
}

async function submitAll(){
    const rows=document.querySelectorAll("tbody tr");

    for(const row of rows){
        const data=new FormData();

        COLUMNS.forEach((c,i)=>{
            if(!c.key) return;
            const input=row.cells[i].querySelector("input");

            if(c.type==="checkbox")
                data.append(ENTRY[c.key],input.checked?"Y":"N");
            else
                data.append(ENTRY[c.key],input.value);
        });

        await fetch(FORM_URL,{method:"POST",mode:"no-cors",body:data});
    }

    alert("완료");
}

function updateSums() {
    const tbody = document.querySelector("#form_table tbody");
    const rows = tbody.querySelectorAll("tr");

    if (rows.length === 0) return;

    const firstInputs = rows[0].querySelectorAll("input[type='number'], input[type='text']");
    const colCount = firstInputs.length;
    const sum_cols = new Array(colCount).fill(0);

    rows.forEach(row => {
        const inputs = row.querySelectorAll("input[type='number'], input[type='text']");
        const sum_row = row.querySelector(".sum_row");

        let rowSum = 0;

        inputs.forEach((input, i) => {
            const val = Number(input.value) || 0;

            sum_cols[i] += val;
            rowSum += val;
        });

        if (sum_row) sum_row.innerText = rowSum;
    });

    const sum_els = document.getElementsByClassName("sum_cols");
    sum_cols.forEach((val, i) => {
        sum_els[i].innerText = val;
    });

    const total = sum_cols.reduce((a, b) => a + b, 0);
    sum_els[sum_els.length - 1].innerText = total;
}

build();

<\/script>
<\/body>
<\/html>`;

            const blob = new Blob([html], { type: "text/html" });
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = "upload_form.html";
            a.click();
        }
    </script>

</body>

</html>